[phases.setup]
# 必要なパッケージを揃えます。cargoとrustcをここに戻します。
nixPkgs = ["nodePackages.npm", "gcc", "rustc", "cargo", "openssl", "pkg-config"]

[phases.build]
# ビルドコマンドを整理します。
# 1. まず Rust のツールチェーンを最新(stable)に更新してからビルドします
cmds = [
    "rustup default stable || true", 
    "cd rust-engine/nurunuru-napi && cargo build --release",
    "mkdir -p rust-engine/nurunuru-napi",
    "cp ../../target/release/libnurunuru_napi.so ./nurunuru-napi.node || cp ../../target/release/nurunuru_napi.node ./nurunuru-napi.node",
    "npm install",
    "npm run build"
]

[start]
cmd = "npm run start"
